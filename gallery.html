<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The LookBook | MEISHA VERNELL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400&family=Bebas+Neue&family=Montserrat:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Turn.js Library for Realistic Page Flipping -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    
    <!-- Global Styles -->
    <link rel="stylesheet" href="main.css">
    
    <!-- Page Styles -->
    <link rel="stylesheet" href="gallery.css">
</head>
<body>
    <nav class="nav" id="nav">
        <div class="nav-links" id="navLinks">
            <a href="portfolio.html" class="nav-link">Portfolio</a>
            <a href="gallery.html" class="nav-link" onclick="closeMobileNav() active">The LookBook</a>
            <a href="https://www.nexustechdigitalsolutions.net" target="_blank" class="nav-link">Tech</a>
            <a href="index.html" class="nav-link nav-star">★</a>
            <a href="https://www.codexlabsinstitute.com" target="_blank" class="nav-link">Codex Labs</a>
            <a href="apps.html" class="nav-link">Apps</a>
            <a href="connect.html" class="nav-link">Connect</a>
        </div>

        <div class="nav-toggle" id="navToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>
    <div class="nav-overlay" id="navOverlay"></div>

    <div class="lookbook-header">
        <h1 class="lookbook-title">Unfiltered</h1>
        <p class="lookbook-subtitle">PIECES OF MEI</p>
    </div>

    <div class="year-selector">
        <button class="year-btn active" data-year="2026" onclick="loadYear('2026')">2026</button>
        <button class="year-btn" data-year="archive" onclick="loadYear('archive')">Archive</button>
    </div>

    <div class="book-wrapper">
        <div class="book-container">
            <div id="flipbook">
                <div class="loading">LOADING LOOKBOOK...</div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p class="footer-text">© 2026 MEISHA VERNELL. ALL RIGHTS RESERVED.</p>
    </footer>

    <script>
        // ============================================
        // CLOUDINARY CONFIGURATION
        // ============================================
        const CLOUDINARY_CLOUD_NAME = 'didqb05ko';
        const CLOUDINARY_TAGS = {
            '2026': 'mv-2026',
            'archive': 'mv-archive'
        };

        let currentYear = '2026';
        let mediaItems = [];
        let bookInitialized = false;

        // ============================================
        // LOAD MEDIA
        // ============================================
        async function loadYear(year) {
            currentYear = year;
            
            // Update buttons
            document.querySelectorAll('.year-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.year === year);
            });

            await loadMedia(year);
            buildBook();
        }

        async function loadMedia(year) {
            const tag = CLOUDINARY_TAGS[year];
            let allMedia = [];

            try {
                // Fetch images from year-specific tag ONLY
                const imageResponse = await fetch(
                    `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/image/list/${tag}.json?_=${Date.now()}`
                );

                if (imageResponse.ok) {
                    const imageData = await imageResponse.json();
                    if (imageData.resources) {
                        const images = imageData.resources.map(resource => ({
                            type: 'image',
                            url: `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/image/upload/q_auto,f_auto/${resource.public_id}.${resource.format}`
                        }));
                        allMedia = allMedia.concat(images);
                    }
                }

                // Fetch videos from year-specific tag ONLY
                const videoResponse = await fetch(
                    `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/video/list/${tag}.json?_=${Date.now()}`
                );

                if (videoResponse.ok) {
                    const videoData = await videoResponse.json();
                    if (videoData.resources) {
                        const videos = videoData.resources.map(resource => ({
                            type: 'video',
                            url: `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/video/upload/q_auto/${resource.public_id}.${resource.format}`
                        }));
                        allMedia = allMedia.concat(videos);
                    }
                }

                mediaItems = allMedia;

            } catch (error) {
                console.error('Error loading media:', error);
                mediaItems = [];
            }
        }

        // ============================================
        // BUILD BOOK
        // ============================================
        function buildBook() {
            const flipbook = $('#flipbook');
            
            // Destroy existing book if any
            if (bookInitialized) {
                flipbook.turn('destroy');
            }

            // Clear and rebuild pages
            flipbook.html('');

            // Front cover
            flipbook.append(`
                <div class="page cover">
                    <h2 class="cover-title">Unfiltered</h2>
                    <p class="cover-subtitle">PIECES OF MEI</p>
                    <p class="cover-year">${currentYear === '2026' ? '2026 EDITION' : 'ARCHIVE EDITION'}</p>
                </div>
            `);

            // Content pages
            if (mediaItems.length === 0) {
                flipbook.append(`
                    <div class="page">
                        <div class="page-content" style="display:flex;align-items:center;justify-content:center;">
                            <div style="text-align:center;color:var(--mid-gray);">
                                <p style="font-family:'Cormorant Garamond',serif;font-size:1.5rem;margin-bottom:1rem;">Coming Soon</p>
                                <p style="font-size:0.8rem;">Upload photos/videos to Cloudinary</p>
                                <p style="font-size:0.7rem;margin-top:0.5rem;">Tag: <strong style="color:var(--gold);">${CLOUDINARY_TAGS[currentYear]}</strong></p>
                            </div>
                        </div>
                    </div>
                `);
            } else {
                mediaItems.forEach((item, index) => {
                    const pageNum = index + 2; // +1 for cover, +1 for 1-based indexing
                    const side = pageNum % 2 === 0 ? 'left' : 'right';
                    
                    flipbook.append(createPageHTML(item, pageNum, side));
                });
            }

            // Back cover
            flipbook.append(`
                <div class="page cover">
                    <h2 class="cover-title">Unfiltered</h2>
                    <p class="cover-subtitle">THE END</p>
                </div>
            `);

            // Initialize Turn.js
            flipbook.turn({
                width: 900,
                height: 600,
                autoCenter: true,
                acceleration: true,
                gradients: true,
                elevation: 50,
                duration: 1000,
                pages: flipbook.children().length,
                when: {
                    turning: function(event, page, view) {
                        // Pause all videos when page starts turning
                        pauseAllVideos();
                    },
                    turned: function(event, page) {
                        // Page turn complete
                    }
                }
            });

            bookInitialized = true;
        }

        function pauseAllVideos() {
            // Find all videos in the book and pause them
            $('[data-video]').each(function() {
                const video = this;
                const container = $(this).closest('[data-video-container]');
                if (!video.paused) {
                    video.pause();
                    container.removeClass('video-playing');
                }
            });
        }

        function createPageHTML(item, pageNum, side) {
            if (item.type === 'video') {
                return `
                    <div class="page">
                        <div class="page-content">
                            <div class="page-media-container" data-video-container>
                                <video src="${item.url}" playsinline data-video>
                                </video>
                                <div class="video-play-btn" data-play-btn></div>
                            </div>
                            <div class="page-number ${side}">${pageNum}</div>
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="page">
                        <div class="page-content">
                            <div class="page-media-container">
                                <img src="${item.url}" alt="Page ${pageNum}" loading="lazy">
                            </div>
                            <div class="page-number ${side}">${pageNum}</div>
                        </div>
                    </div>
                `;
            }
        }

        function attachVideoHandlers() {
            // Use event delegation since Turn.js manipulates the DOM
            $(document).on('click', '[data-play-btn]', function(e) {
                e.stopPropagation();
                const container = $(this).closest('[data-video-container]');
                const video = container.find('[data-video]')[0];
                toggleVideo(video, container);
            });

            $(document).on('click', '[data-video]', function(e) {
                e.stopPropagation();
                const video = this;
                const container = $(this).closest('[data-video-container]');
                toggleVideo(video, container);
            });
        }

        function toggleVideo(video, container) {
            if (!video) return;
            
            if (video.paused) {
                video.play().catch(err => {
                    console.log('Video play failed:', err);
                });
                container.addClass('video-playing');
            } else {
                video.pause();
                container.removeClass('video-playing');
            }
        }

        // ============================================
        // NAVIGATION
        // ============================================
        function nextPage() {
            $('#flipbook').turn('next');
        }

        function previousPage() {
            $('#flipbook').turn('previous');
        }

        // Keyboard navigation
        $(document).keydown(function(e) {
            if (e.keyCode === 37) previousPage(); // Left arrow
            if (e.keyCode === 39) nextPage(); // Right arrow
        });

        // ============================================
        // NAV & MOBILE
        // ============================================
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('nav');
            if (window.scrollY > 50) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }
        });

        // ============================================
        // INITIALIZE
        // ============================================
        $(document).ready(async function() {
            // Attach video handlers first (using event delegation)
            attachVideoHandlers();
            
            // Then load and build book
            await loadMedia(currentYear);
            buildBook();
        });
    </script>
    
    <!-- Navigation JS -->
    <script src="main.js" defer></script>
</body>
</html>
